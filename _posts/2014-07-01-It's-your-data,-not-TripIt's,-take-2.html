---
layout: post
title: It's your data, not TripIt's, take 2
date: 2014-07-01 15:30:00 UTC
updated: 2014-07-01 15:30:00 UTC
comments: false
categories: etl excel power query ruby tripit
---
<h2>Minimal viable products are sometimes too minimal</h2>A couple of weeks ago, I posted <a href="http://muness.blogspot.com/2014/06/its-your-data-not-tripits-example-of.html">a blog post</a>&nbsp;on how I extracted my trip information from TripIt to calculate the number of days I traveled last year. Being the second iteration of the process (the first one was: open the page in TripIt, copy and paste to a text file, calculate manually), it worked, but I knew I could make it less crappy: introducing OpenFlights.org wasn't great: every time I fly, I would have to go back there and reimport the new records. The process included manual work to identify trip start and end dates and to distinguish between business and personal trips. Also, I didn't like that only trips with flights were included as some of my trips were<br />
<h2>Let's automate some things</h2>Tonight, I looked a into TripIt's API and once I figured out <i><a href="http://blog.andydenmark.com/2009/03/how-to-build-oauth-consumer.html">their</a> </i>OAuth scheme, I had a&nbsp;<a href="http://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">REPL</a>&nbsp;session working, getting data from TripIt's servers. After a spike, processing a page of the data, I decided not to change the data. I then wrote a script that grabbed all the pages of my trips data, combined all <i>Trip</i>&nbsp;nodes and saved them all to an XML file for &nbsp;<a href="http://www.microsoft.com/en-us/download/details.aspx?id=39379">import</a> and <a href="http://office.microsoft.com/en-us/excel/">analysis</a>.<br />
<h2>Some code...</h2>My script for exporting TripIt data is over in a <a href="https://github.com/muness/tripit-export-trips-to-xml">github repo</a>. Enjoy! Aside from the authentication, there are only a <a href="https://gist.github.com/muness/f771e4eee45b6b801e06#file-gistfile1-rb">few of lines code</a>:<br />
<code><br />
<pre>xml_out.Trips do # build a Trips node
  for page in (1..pages) # defeat pagination...
    past_trips = t.list.trip({'past' =&gt; 'true', 'include_objects' =&gt; 'false', 'traveler' =&gt; 'true', "page_size" =&gt; "30", "page_num" =&gt; page})
    node = Nokogiri::XML(past_trips.to_xml.to_s)
    xml_out &lt;&lt; node.xpath("//Trip").to_xml # extract each Trip node and add it to the Trips node built above
  end
end
</code></pre><h2>I can haz xml... now what?</h2>Caveat: the data format from TripIt's API isn't pleasant to work with. Use your ETL skills to make it useful.  I used Power Query because I want to get better at using it. With Power Query, you define your data source and apply filters, schema manipulations and value manipulations.  I did several manipulations to make the data useful: I expanded some XML nodes, moved some columns, removed others and renamed some. I also manipulated the data by defining data types, doing some string manipulations so that partial URIs like /trip/show/id/xxxx would become full trip it URLs I can follow and changing values that match "Raleigh, NC" to "Durham, NC". <br />
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody>
<tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-zUGAcluUO9Q/U65eze0KCfI/AAAAAAAAFWw/afdoGuBUXSQ/s1600/Power+Query+steps.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://3.bp.blogspot.com/-zUGAcluUO9Q/U65eze0KCfI/AAAAAAAAFWw/afdoGuBUXSQ/s1600/Power+Query+steps.PNG" /></a></td></tr>
<tr><td class="tr-caption" style="text-align: center;">Power Query steps</td></tr>
</tbody></table>On loading this data to <a href="http://office.microsoft.com/en-us/excel-help/create-a-data-model-in-excel-HA102923361.aspx">the data model</a>, I added a calculated field (trip duration) and a couple of clicks later, the report I wanted was ready. To update the report, I rerun the script, launch Excel and press Refresh All.  <br />
<div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-nymPA3rBZdA/U65nIKVP4wI/AAAAAAAAFXA/2Okqy6jDYZI/s1600/imageedit_7_9857635915.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-nymPA3rBZdA/U65nIKVP4wI/AAAAAAAAFXA/2Okqy6jDYZI/s1600/imageedit_7_9857635915.jpg" height="320" width="252" /></a></div><br />
What are you going to do with your TripIt data?<br />
<br />
